<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1"> 
  <title>Order Status — Desi Aura</title>
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="icon" type="image/x-icon" href="/images/desi-aura.ico">
<link rel="shortcut icon" href="/images/desi-aura.ico">
  <style>
    /* Order status specific styles */
    .order-status-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .track-order-section {
      background: var(--background);
      border: 2px solid var(--border-color);
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 30px;
      text-align: center;
    }
    
    .track-order-section h2 {
      color: var(--primary);
      margin: 0 0 20px 0;
      font-size: 1.8rem;
    }
    
    .track-options {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    
    .track-option {
      display: flex;
      align-items: center;
      margin: 0 15px;
      cursor: pointer;
    }
    
    .track-option input {
      margin-right: 8px;
    }
    
    .track-form {
      max-width: 500px;
      margin: 0 auto;
    }
    
    .form-group {
      margin-bottom: 15px;
      text-align: left;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: var(--text-dark);
    }
    
    .form-group input {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid var(--border-color);
      border-radius: 30px;
      font-size: 1rem;
      box-sizing: border-box;
    }
    
    .form-group input:focus {
      outline: none;
      border-color: var(--primary);
    }
    
    .track-button {
      background: var(--primary);
      color: var(--text-light);
      border: none;
      padding: 12px 30px;
      border-radius: 30px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .track-button:hover {
      background: var(--accent);
    }
    
    .track-button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    .order-header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: var(--secondary);
      border-radius: 12px;
      border: 2px solid var(--border-color);
    }
    
    .order-header h1 {
      color: var(--primary);
      margin: 0 0 10px 0;
      font-size: 2rem;
    }
    
    .order-id {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--accent);
      margin: 10px 0;
    }
    
    .order-status {
      display: inline-block;
      padding: 8px 20px;
      border-radius: 20px;
      font-weight: bold;
      margin: 10px 0;
      text-transform: uppercase;
    }
    
    .status-pending {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }
    
    .status-processing {
      background: #cce5ff;
      color: #004085;
      border: 1px solid #b3d7ff;
    }
    
    .status-shipped {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .status-delivered {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    
    .order-section {
      background: var(--background);
      border: 2px solid var(--border-color);
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 20px;
    }
    
    .order-section h2 {
      color: var(--primary);
      margin: 0 0 20px 0;
      font-size: 1.5rem;
      border-bottom: 2px solid var(--border-color);
      padding-bottom: 10px;
    }
    
    .info-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    
    .info-item {
      margin-bottom: 15px;
    }
    
    .info-label {
      font-weight: bold;
      color: var(--text-dark);
      margin-bottom: 5px;
    }
    
    .info-value {
      color: var(--muted-text);
    }
    
    .order-items {
      margin-top: 20px;
    }
    
    .order-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      border-bottom: 1px solid var(--border-color);
      background: var(--secondary);
      border-radius: 8px;
      margin-bottom: 10px;
    }
    
    .order-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
    }
    
    .item-info {
      flex: 1;
    }
    
    .item-name {
      font-weight: bold;
      color: var(--text-dark);
      font-size: 1.1rem;
    }
    
    .item-details {
      color: var(--muted-text);
      margin-top: 5px;
    }
    
    .item-price {
      font-weight: bold;
      color: var(--primary);
      font-size: 1.1rem;
    }
    
    .order-total {
      text-align: right;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 2px solid var(--border-color);
    }
    
    .total-amount {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--primary);
    }
    
    .loading {
      text-align: center;
      padding: 50px;
    }
    
    .spinner {
      border: 4px solid var(--border-color);
      border-top: 4px solid var(--primary);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .error {
      text-align: center;
      padding: 50px;
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      border-radius: 8px;
      color: #721c24;
    }
    
    .back-button {
      display: inline-block;
      background: var(--primary);
      color: var(--text-light);
      padding: 12px 24px;
      border-radius: 30px;
      text-decoration: none;
      font-weight: bold;
      margin-top: 20px;
      transition: all 0.3s ease;
    }
    
    .back-button:hover {
      background: var(--accent);
      transform: translateY(-2px);
    }
    
    .timeline {
      margin-top: 20px;
      position: relative;
    }
    
    .timeline::before {
      content: '';
      position: absolute;
      left: 20px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: var(--border-color);
    }
    
    .timeline-item {
      position: relative;
      padding-left: 50px;
      margin-bottom: 20px;
    }
    
    .timeline-item::before {
      content: '';
      position: absolute;
      left: 14px;
      top: 5px;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: var(--border-color);
      border: 2px solid var(--background);
    }
    
    .timeline-item.completed::before {
      background: var(--primary);
    }
    
    .timeline-content {
      background: var(--secondary);
      padding: 10px 15px;
      border-radius: 8px;
      border: 1px solid var(--border-color);
    }
    
    .timeline-title {
      font-weight: bold;
      color: var(--text-dark);
    }
    
    .timeline-date {
      font-size: 0.9rem;
      color: var(--muted-text);
    }
    
    .multiple-orders {
      margin-top: 20px;
    }
    
    .order-card {
      background: var(--secondary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .order-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .order-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .order-card-id {
      font-weight: bold;
      color: var(--primary);
    }
    
    .order-card-date {
      font-size: 0.9rem;
      color: var(--muted-text);
    }
    
    .order-card-status {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: bold;
      text-transform: uppercase;
    }
    
    .order-card-total {
      font-weight: bold;
      color: var(--text-dark);
    }
    
    @media (max-width: 768px) {
      .track-options {
        flex-direction: column;
        align-items: center;
      }
      
      .track-option {
        margin: 5px 0;
      }
      
      .info-grid {
        grid-template-columns: 1fr;
      }
      
      .order-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      
      .item-price {
        align-self: flex-end;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Desi Aura</h1>
    <nav>
      <a href="/index.html">Home</a>
      <a href="/shop.html">Shop</a>
      <a href="/cart.html">Cart <span id="cart-count" class="cart-count">0</span></a>
      <a href="/order-status.html">Track Order</a>
    </nav>
  </header>

  <main class="order-status-container">
    <div class="track-order-section">
      <h2>Track Your Order</h2>
      
      <div class="track-options">
        <div class="track-option">
          <input type="radio" id="track-by-id" name="track-method" value="id" checked>
          <label for="track-by-id">Order ID</label>
        </div>
        <div class="track-option">
          <input type="radio" id="track-by-phone" name="track-method" value="phone">
          <label for="track-by-phone">Mobile Number</label>
        </div>
      </div>
      
      <div class="track-form">
        <div class="form-group" id="order-id-group">
          <label for="order-id-input">Enter Order ID</label>
          <input type="text" id="order-id-input" placeholder="e.g., ORD-ABC12345">
        </div>
        
        <div class="form-group" id="phone-group" style="display: none;">
          <label for="phone-input">Enter Mobile Number</label>
          <input type="tel" id="phone-input" placeholder="e.g., 9876543210">
        </div>
        
        <button id="track-button" class="track-button">Track Order</button>
      </div>
    </div>
    
    <div id="loading" class="loading" style="display: none;">
      <div class="spinner"></div>
      <p>Loading order details...</p>
    </div>
    
    <div id="error" class="error" style="display: none;">
      <h2>Order Not Found</h2>
      <p id="error-message">We couldn't find the order you're looking for. Please check the order ID and try again.</p>
      <a href="/index.html" class="back-button">Return to Home</a>
    </div>
    
    <div id="multiple-orders" style="display: none;">
      <div class="order-section">
        <h2>Multiple Orders Found</h2>
        <p>We found multiple orders associated with this mobile number. Please select one to view details:</p>
        <div id="orders-list"></div>
      </div>
    </div>
    
    <div id="order-content" style="display: none;">
      <div class="order-header">
        <h1>Order Status</h1>
        <div class="order-id" id="order-id"></div>
        <div class="order-status" id="order-status"></div>
        <p id="order-date"></p>
      </div>
      
      <div class="order-section">
        <h2>Order Timeline</h2>
        <div class="timeline" id="timeline">
          <div class="timeline-item completed">
            <div class="timeline-content">
              <div class="timeline-title">Order Placed</div>
              <div class="timeline-date" id="placed-date"></div>
            </div>
          </div>
          <div class="timeline-item" id="processing-item">
            <div class="timeline-content">
              <div class="timeline-title">Processing</div>
              <div class="timeline-date">Your order is being prepared</div>
            </div>
          </div>
          <div class="timeline-item" id="shipped-item">
            <div class="timeline-content">
              <div class="timeline-title">Shipped</div>
              <div class="timeline-date">Order has been shipped</div>
            </div>
          </div>
          <div class="timeline-item" id="delivered-item">
            <div class="timeline-content">
              <div class="timeline-title">Delivered</div>
              <div class="timeline-date">Order has been delivered</div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="order-section">
        <h2>Customer Information</h2>
        <div class="info-grid">
          <div class="info-item">
            <div class="info-label">Name</div>
            <div class="info-value" id="customer-name"></div>
          </div>
          <div class="info-item">
            <div class="info-label">Phone</div>
            <div class="info-value" id="customer-phone"></div>
          </div>
          <div class="info-item">
            <div class="info-label">Email</div>
            <div class="info-value" id="customer-email"></div>
          </div>
          <div class="info-item">
            <div class="info-label">Payment Method</div>
            <div class="info-value">Cash on Delivery</div>
          </div>
        </div>
      </div>
      
      <div class="order-section">
        <h2>Shipping Address</h2>
        <div class="info-value" id="shipping-address"></div>
      </div>
      
      <div class="order-section">
        <h2>Order Items</h2>
        <div class="order-items" id="order-items"></div>
        <div class="order-total">
          <div class="total-amount" id="total-amount"></div>
        </div>
      </div>
      
      <div style="text-align: center;">
        <a href="/shop.html" class="back-button">Continue Shopping</a>
      </div>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 Desi Aura. All rights reserved.</p>
    <div class="footer-links">
      <a href="/index.html">Home</a>
      <a href="/shop.html">Shop</a>
      <a href="/order-status.html">Track Order</a>
    </div>
  </footer>

  <script src="assets/js/config.js"></script>
  <script src="assets/js/api.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Track method toggle
      const trackOptions = document.querySelectorAll('input[name="track-method"]');
      const orderIdGroup = document.getElementById('order-id-group');
      const phoneGroup = document.getElementById('phone-group');
      
      trackOptions.forEach(option => {
        option.addEventListener('change', function() {
          if (this.value === 'id') {
            orderIdGroup.style.display = 'block';
            phoneGroup.style.display = 'none';
          } else {
            orderIdGroup.style.display = 'none';
            phoneGroup.style.display = 'block';
          }
        });
      });
      
      // Track button click
      document.getElementById('track-button').addEventListener('click', trackOrder);
      
      // Enter key support
      document.getElementById('order-id-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') trackOrder();
      });
      
      document.getElementById('phone-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') trackOrder();
      });
      
      // Check if there's an order ID in the URL
      const urlParams = new URLSearchParams(window.location.search);
      const orderId = urlParams.get('id');
      
      if (orderId) {
        document.getElementById('order-id-input').value = orderId;
        trackOrder();
      }
    });
    
    function trackOrder() {
      const trackMethod = document.querySelector('input[name="track-method"]:checked').value;
      let searchValue;
      
      if (trackMethod === 'id') {
        searchValue = document.getElementById('order-id-input').value.trim();
        if (!searchValue) {
          showError('Please enter an order ID');
          return;
        }
        fetchOrderById(searchValue);
      } else {
        searchValue = document.getElementById('phone-input').value.trim();
        if (!searchValue) {
          showError('Please enter a mobile number');
          return;
        }
        // Validate phone number (10 digits)
        if (!/^\d{10}$/.test(searchValue)) {
          showError('Please enter a valid 10-digit mobile number');
          return;
        }
        fetchOrdersByPhone(searchValue);
      }
    }
    
    async function fetchOrderById(orderId) {
      showLoading();
      try {
        const order = await API.getOrder(orderId);
        displayOrderDetails(order);
      } catch (error) {
        console.error('Error fetching order:', error);
        showError('We couldn\'t find an order with this ID. Please check and try again.');
      }
    }
    
    async function fetchOrdersByPhone(phone) {
      showLoading();
      try {
        // Since there's no direct API endpoint for searching by phone,
        // we'll need to create one in the backend
        const response = await fetch(`${API_BASE_URL}/api/orders/by-phone/${phone}`);
        
        if (!response.ok) {
          throw new Error('Orders not found');
        }
        
        const orders = await response.json();
        
        if (orders.length === 0) {
          showError('We couldn\'t find any orders associated with this mobile number.');
        } else if (orders.length === 1) {
          displayOrderDetails(orders[0]);
        } else {
          displayMultipleOrders(orders);
        }
      } catch (error) {
        console.error('Error fetching orders by phone:', error);
        showError('We couldn\'t find any orders associated with this mobile number.');
      }
    }
    
    function displayMultipleOrders(orders) {
      hideLoading();
      document.getElementById('multiple-orders').style.display = 'block';
      
      const ordersList = document.getElementById('orders-list');
      ordersList.innerHTML = orders.map(order => `
        <div class="order-card" onclick="selectOrder('${order.id}')">
          <div class="order-card-header">
            <div class="order-card-id">Order #${order.id}</div>
            <div class="order-card-status status-${order.status || 'pending'}">${order.status || 'Pending'}</div>
          </div>
          <div class="order-card-date">Placed on ${new Date(order.createdAt).toLocaleDateString()}</div>
          <div class="order-card-total">Total: ₹${order.total.toFixed(2)}</div>
        </div>
      `).join('');
    }
    
    function selectOrder(orderId) {
      document.getElementById('multiple-orders').style.display = 'none';
      fetchOrderById(orderId);
    }
    
    function displayOrderDetails(order) {
      hideLoading();
      document.getElementById('order-content').style.display = 'block';
      
      // Update order header
      document.getElementById('order-id').textContent = `#${order.id}`;
      document.getElementById('order-status').textContent = order.status || 'Pending';
      document.getElementById('order-date').textContent = `Order placed on ${new Date(order.createdAt).toLocaleDateString()}`;
      
      // Update status styling
      const statusElement = document.getElementById('order-status');
      statusElement.className = 'order-status status-' + (order.status || 'pending');
      
      // Update timeline based on status
      updateTimeline(order.status);
      
      // Update customer information
      document.getElementById('customer-name').textContent = order.customerName;
      document.getElementById('customer-phone').textContent = order.customerPhone || 'Not provided';
      document.getElementById('customer-email').textContent = order.customerEmail || 'Not provided';
      document.getElementById('shipping-address').textContent = order.address;
      
      // Update order items
      const itemsContainer = document.getElementById('order-items');
      itemsContainer.innerHTML = order.items.map(item => `
        <div class="order-item">
          <div class="item-info">
            <div class="item-name">${item.name}</div>
            <div class="item-details">Quantity: ${item.quantity} × ₹${item.price.toFixed(2)}</div>
          </div>
          <div class="item-price">₹${item.lineTotal.toFixed(2)}</div>
        </div>
      `).join('');
      
      // Update total
      document.getElementById('total-amount').textContent = `Total: ₹${order.total.toFixed(2)}`;
      
      // Update placed date in timeline
      document.getElementById('placed-date').textContent = new Date(order.createdAt).toLocaleString();
    }
    
    function updateTimeline(status) {
      const processingItem = document.getElementById('processing-item');
      const shippedItem = document.getElementById('shipped-item');
      const deliveredItem = document.getElementById('delivered-item');
      
      // Reset all items
      processingItem.classList.remove('completed');
      shippedItem.classList.remove('completed');
      deliveredItem.classList.remove('completed');
      
      switch(status) {
        case 'processing':
          processingItem.classList.add('completed');
          break;
        case 'shipped':
          processingItem.classList.add('completed');
          shippedItem.classList.add('completed');
          break;
        case 'delivered':
          processingItem.classList.add('completed');
          shippedItem.classList.add('completed');
          deliveredItem.classList.add('completed');
          break;
        default:
          // pending - only first item is completed
          break;
      }
    }
    
    function showLoading() {
      document.getElementById('loading').style.display = 'block';
      document.getElementById('error').style.display = 'none';
      document.getElementById('multiple-orders').style.display = 'none';
      document.getElementById('order-content').style.display = 'none';
    }
    
    function hideLoading() {
      document.getElementById('loading').style.display = 'none';
    }
    
    function showError(message) {
      hideLoading();
      document.getElementById('error-message').textContent = message;
      document.getElementById('error').style.display = 'block';
      document.getElementById('multiple-orders').style.display = 'none';
      document.getElementById('order-content').style.display = 'none';
    }
  </script>
</body>
</html>
