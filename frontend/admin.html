<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1"> 
  <title>Admin Panel — Desi Aura</title>
  <link rel="icon" type="image/x-icon" href="/images/desi-aura.png">
<link rel="shortcut icon" href="/images/desi-aura.png">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      --primary: #8b1f3a;
      --accent: #a02c5a;
      --secondary: #f8f9fa;
      --background: #ffffff;
      --text-dark: #333333;
      --text-light: #ffffff;
      --muted-text: #666666;
      --border-color: #e0e0e0;
      --success: #28a745;
      --warning: #ffc107;
      --danger: #dc3545;
      --info: #17a2b8;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    /* Login Styles */
    .login-container {
      background: var(--background);
      padding: 40px;
      border-radius: 15px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 400px;
      text-align: center;
    }
    
    .login-container h1 {
      color: var(--primary);
      margin-bottom: 30px;
      font-size: 2rem;
    }
    
    .login-container .logo {
      font-size: 3rem;
      margin-bottom: 20px;
    }
    
    .form-group {
      margin-bottom: 20px;
      text-align: left;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--text-dark);
    }
    
    .form-group input {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }
    
    .form-group input:focus {
      outline: none;
      border-color: var(--primary);
    }
    
    .login-btn {
      width: 100%;
      padding: 12px;
      background: var(--primary);
      color: var(--text-light);
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .login-btn:hover {
      background: var(--accent);
      transform: translateY(-2px);
    }
    
    .error-message {
      color: var(--danger);
      margin-top: 15px;
      padding: 10px;
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      border-radius: 5px;
      display: none;
    }
    
    /* Admin Panel Styles */
    .admin-container {
      display: none;
      width: 100%;
      max-width: 1400px;
      margin: 20px auto;
      padding: 0 20px;
    }
    
    .admin-header {
      background: var(--background);
      padding: 20px 30px;
      border-radius: 15px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .admin-header h1 {
      color: var(--primary);
      font-size: 2rem;
    }
    
    .admin-header .logo {
      font-size: 2.5rem;
      color: var(--primary);
    }
    
    .logout-btn {
      background: var(--danger);
      color: var(--text-light);
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .logout-btn:hover {
      background: #c82333;
    }
    
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: var(--background);
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      text-align: center;
      transition: transform 0.3s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
    }
    
    .stat-number {
      font-size: 2.5rem;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .stat-label {
      color: var(--muted-text);
      font-size: 1rem;
    }
    
    .stat-card.pending { border-left: 5px solid var(--warning); }
    .stat-card.processing { border-left: 5px solid var(--info); }
    .stat-card.shipped { border-left: 5px solid var(--primary); }
    .stat-card.delivered { border-left: 5px solid var(--success); }
    
    .orders-section {
      background: var(--background);
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }
    
    .section-header h2 {
      color: var(--primary);
      font-size: 1.5rem;
    }
    
    .search-filter {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .search-input {
      flex: 1;
      padding: 10px 15px;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      font-size: 1rem;
    }
    
    .filter-select {
      padding: 10px 15px;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      font-size: 1rem;
      background: var(--background);
    }
    
    .refresh-btn {
      background: var(--info);
      color: var(--text-light);
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .refresh-btn:hover {
      background: #138496;
    }
    
    .orders-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    
    .orders-table th {
      background: var(--secondary);
      padding: 15px;
      text-align: left;
      font-weight: 600;
      color: var(--text-dark);
      border-bottom: 2px solid var(--border-color);
    }
    
    .orders-table td {
      padding: 15px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .orders-table tr:hover {
      background: var(--secondary);
    }
    
    .order-id {
      font-weight: bold;
      color: var(--primary);
      cursor: pointer;
    }
    
    .order-id:hover {
      text-decoration: underline;
    }
    
    .status-badge {
      display: inline-block;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: bold;
      text-transform: uppercase;
    }
    
    .status-pending {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }
    
    .status-processing {
      background: #cce5ff;
      color: #004085;
      border: 1px solid #b3d7ff;
    }
    
    .status-shipped {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .status-out-for-delivery {
      background: #e3f2fd;
      color: #0d47a1;
      border: 1px solid #bbdefb;
    }
    
    .status-delivered {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    
    .action-buttons {
      display: flex;
      gap: 8px;
    }
    
    .action-btn {
      padding: 6px 12px;
      border: none;
      border-radius: 5px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .view-btn {
      background: var(--info);
      color: var(--text-light);
    }
    
    .view-btn:hover {
      background: #138496;
    }
    
    .edit-btn {
      background: var(--primary);
      color: var(--text-light);
    }
    
    .edit-btn:hover {
      background: var(--accent);
    }
    
    .no-orders {
      text-align: center;
      padding: 40px;
      color: var(--muted-text);
    }
    
    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .modal-content {
      background-color: var(--background);
      margin: 2% auto;
      padding: 0;
      border-radius: 15px;
      width: 90%;
      max-width: 600px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      animation: slideIn 0.3s ease;
    }
    
    @keyframes slideIn {
      from {
        transform: translateY(-50px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 30px;
      border-bottom: 1px solid var(--border-color);
      background: var(--secondary);
      border-radius: 15px 15px 0 0;
    }
    
    .modal-header h2 {
      color: var(--primary);
      margin: 0;
    }
    
    .close {
      color: var(--muted-text);
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      transition: color 0.3s ease;
    }
    
    .close:hover {
      color: var(--danger);
    }
    
    .modal-body {
      padding: 30px;
      max-height: 70vh;
      overflow-y: auto;
    }
    
    .order-details {
      margin-bottom: 25px;
    }
    
    .detail-row {
      display: flex;
      margin-bottom: 15px;
    }
    
    .detail-label {
      font-weight: bold;
      color: var(--text-dark);
      min-width: 150px;
    }
    
    .detail-value {
      color: var(--muted-text);
    }
    
    .order-items-list {
      margin-top: 20px;
    }
    
    .order-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      background: var(--secondary);
      border-radius: 8px;
      margin-bottom: 10px;
    }
    
    .item-info {
      flex: 1;
    }
    
    .item-name {
      font-weight: bold;
      color: var(--text-dark);
    }
    
    .item-details {
      font-size: 0.9rem;
      color: var(--muted-text);
    }
    
    .item-price {
      font-weight: bold;
      color: var(--primary);
    }
    
    .status-options {
      margin-bottom: 20px;
    }
    
    .status-option {
      margin-bottom: 15px;
      padding: 15px;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .status-option:hover {
      border-color: var(--primary);
      background-color: rgba(139,31,58,0.05);
    }
    
    .status-option.selected {
      border-color: var(--primary);
      background-color: rgba(139,31,58,0.1);
    }
    
    .status-radio {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .status-description {
      font-size: 0.9rem;
      color: var(--muted-text);
      margin-left: 25px;
    }
    
    .form-group textarea {
      width: 100%;
      padding: 10px;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      font-size: 1rem;
      min-height: 80px;
      resize: vertical;
      font-family: inherit;
    }
    
    .form-group textarea:focus {
      outline: none;
      border-color: var(--primary);
    }
    
    .checkbox-group {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .checkbox-group input[type="checkbox"] {
      margin-right: 10px;
    }
    
    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 15px;
      padding: 20px 30px;
      border-top: 1px solid var(--border-color);
      background: var(--secondary);
      border-radius: 0 0 15px 15px;
    }
    
    .cancel-button {
      background: var(--background);
      color: var(--text-dark);
      border: 2px solid var(--border-color);
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .cancel-button:hover {
      background: var(--secondary);
    }
    
    .save-button {
      background: var(--primary);
      color: var(--text-light);
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .save-button:hover {
      background: var(--accent);
    }
    
    .quick-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }
    
    .quick-action-btn {
      background: var(--secondary);
      color: var(--text-dark);
      border: 1px solid var(--border-color);
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .quick-action-btn:hover {
      background: var(--primary);
      color: var(--text-light);
    }
    
    /* Toast Notifications */
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 8px;
      color: var(--text-light);
      font-weight: bold;
      z-index: 2000;
      animation: slideInRight 0.3s ease;
      display: none;
    }
    
    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    .toast.success {
      background: var(--success);
    }
    
    .toast.error {
      background: var(--danger);
    }
    
    .toast.info {
      background: var(--info);
    }
    
    /* Loading Spinner */
    .loading {
      text-align: center;
      padding: 40px;
    }
    
    .spinner {
      border: 4px solid var(--border-color);
      border-top: 4px solid var(--primary);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .admin-container {
        padding: 0 10px;
      }
      
      .admin-header {
        flex-direction: column;
        gap: 15px;
        text-align: center;
      }
      
      .stats-container {
        grid-template-columns: 1fr;
      }
      
      .search-filter {
        flex-direction: column;
      }
      
      .orders-table {
        font-size: 0.9rem;
      }
      
      .orders-table th,
      .orders-table td {
        padding: 10px 5px;
      }
      
      .action-buttons {
        flex-direction: column;
      }
      
      .modal-content {
        width: 95%;
        margin: 5% auto;
      }
      
      .modal-body {
        padding: 20px;
      }
      
      .detail-row {
        flex-direction: column;
        margin-bottom: 10px;
      }
      
      .detail-label {
        min-width: auto;
        margin-bottom: 5px;
      }
    }
  </style>
</head>
<body>
  <!-- Login Container -->
  <div id="login-container" class="login-container">
    <div class="logo">🏪</div>
    <h1>Admin Login</h1>
    <form id="login-form">
      <div class="form-group">
        <label for="password">Password:</label>
        <input type="password" id="password" required placeholder="Enter admin password">
      </div>
      <button type="submit" class="login-btn">Login</button>
      <div id="error-message" class="error-message"></div>
    </form>
  </div>

  <!-- Admin Panel -->
  <div id="admin-container" class="admin-container">
    <div class="admin-header">
      <div>
        <div class="logo">🏪</div>
        <h1>Admin Panel</h1>
      </div>
      <button id="logout-btn" class="logout-btn">Logout</button>
    </div>

    <!-- Statistics Cards -->
    <div class="stats-container">
      <div class="stat-card pending">
        <div class="stat-number" id="pending-count">0</div>
        <div class="stat-label">Pending Orders</div>
      </div>
      <div class="stat-card processing">
        <div class="stat-number" id="processing-count">0</div>
        <div class="stat-label">Processing</div>
      </div>
      <div class="stat-card shipped">
        <div class="stat-number" id="shipped-count">0</div>
        <div class="stat-label">Shipped</div>
      </div>
      <div class="stat-card delivered">
        <div class="stat-number" id="delivered-count">0</div>
        <div class="stat-label">Delivered</div>
      </div>
    </div>

    <!-- Orders Section -->
    <div class="orders-section">
      <div class="section-header">
        <h2>All Orders</h2>
        <button id="refresh-btn" class="refresh-btn">🔄 Refresh</button>
      </div>

      <div class="search-filter">
        <input type="text" id="search-input" class="search-input" placeholder="Search by order ID, name, or phone...">
        <select id="status-filter" class="filter-select">
          <option value="">All Status</option>
          <option value="pending">Pending</option>
          <option value="processing">Processing</option>
          <option value="shipped">Shipped</option>
          <option value="out-for-delivery">Out for Delivery</option>
          <option value="delivered">Delivered</option>
        </select>
      </div>

      <div id="orders-container">
        <div class="loading">
          <div class="spinner"></div>
          <p>Loading orders...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Order Details Modal -->
  <div id="order-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Order Details</h2>
        <span class="close">&times;</span>
      </div>
      <div class="modal-body">
        <div class="order-details" id="order-details">
          <!-- Order details will be populated here -->
        </div>
        
        <h3>Update Order Status</h3>
        <div class="status-options">
          <div class="status-option" data-status="pending">
            <div class="status-radio">
              <input type="radio" name="status" id="status-pending" value="pending">
              <label for="status-pending">Pending</label>
            </div>
            <div class="status-description">Order has been received but not yet processed</div>
          </div>
          <div class="status-option" data-status="processing">
            <div class="status-radio">
              <input type="radio" name="status" id="status-processing" value="processing">
              <label for="status-processing">Processing</label>
            </div>
            <div class="status-description">Order is being prepared for shipping</div>
          </div>
          <div class="status-option" data-status="shipped">
            <div class="status-radio">
              <input type="radio" name="status" id="status-shipped" value="shipped">
              <label for="status-shipped">Shipped</label>
            </div>
            <div class="status-description">Order has been shipped and is on its way</div>
          </div>
          <div class="status-option" data-status="out-for-delivery">
            <div class="status-radio">
              <input type="radio" name="status" id="status-out-for-delivery" value="out-for-delivery">
              <label for="status-out-for-delivery">Out for Delivery</label>
            </div>
            <div class="status-description">Order is out for delivery and will arrive today</div>
          </div>
          <div class="status-option" data-status="delivered">
            <div class="status-radio">
              <input type="radio" name="status" id="status-delivered" value="delivered">
              <label for="status-delivered">Delivered</label>
            </div>
            <div class="status-description">Order has been successfully delivered</div>
          </div>
        </div>

        <div class="form-group">
          <label for="status-note">Add a note (optional):</label>
          <textarea id="status-note" placeholder="Add any additional information about this status update"></textarea>
        </div>

        <div class="checkbox-group">
          <input type="checkbox" id="notify-customer" checked>
          <label for="notify-customer">Send email notification to customer</label>
        </div>

        <h3>Quick Actions</h3>
        <div class="quick-actions" id="quick-actions">
          <!-- Quick action buttons will be added here -->
        </div>
      </div>
      <div class="modal-footer">
        <button id="cancel-status-update" class="cancel-button">Cancel</button>
        <button id="save-status-update" class="save-button">Update Status</button>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toast-container"></div>

  <script>
    // Configuration
    const ADMIN_PASSWORD = 'DesiAura2025'; // Change this to your preferred password
    const API_BASE_URL = 'https://desi-aura-backend.onrender.com';
    
    // State management
    let currentOrders = [];
    let filteredOrders = [];
    let currentOrder = null;
    
    // DOM Elements
    const loginContainer = document.getElementById('login-container');
    const adminContainer = document.getElementById('admin-container');
    const loginForm = document.getElementById('login-form');
    const passwordInput = document.getElementById('password');
    const errorMessage = document.getElementById('error-message');
    const logoutBtn = document.getElementById('logout-btn');
    const refreshBtn = document.getElementById('refresh-btn');
    const searchInput = document.getElementById('search-input');
    const statusFilter = document.getElementById('status-filter');
    const ordersContainer = document.getElementById('orders-container');
    const orderModal = document.getElementById('order-modal');
    const modalClose = document.querySelector('.close');
    const cancelBtn = document.getElementById('cancel-status-update');
    const saveBtn = document.getElementById('save-status-update');
    
    // Check if already logged in
    document.addEventListener('DOMContentLoaded', function() {
      if (sessionStorage.getItem('adminLoggedIn') === 'true') {
        showAdminPanel();
      }
    });
    
    // Login functionality
    loginForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const password = passwordInput.value;
      
      if (password === ADMIN_PASSWORD) {
        sessionStorage.setItem('adminLoggedIn', 'true');
        showAdminPanel();
      } else {
        showError('Incorrect password. Please try again.');
        passwordInput.value = '';
      }
    });
    
    // Logout functionality
    logoutBtn.addEventListener('click', function() {
      sessionStorage.removeItem('adminLoggedIn');
      showLogin();
    });
    
    // Show admin panel
    function showAdminPanel() {
      loginContainer.style.display = 'none';
      adminContainer.style.display = 'block';
      loadAllOrders();
    }
    
    // Show login screen
    function showLogin() {
      loginContainer.style.display = 'block';
      adminContainer.style.display = 'none';
      passwordInput.value = '';
      errorMessage.style.display = 'none';
    }
    
    // Show error message
    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.style.display = 'block';
      setTimeout(() => {
        errorMessage.style.display = 'none';
      }, 5000);
    }
    
    // Load all orders
    async function loadAllOrders() {
      try {
        showLoading();
        const response = await fetch(`${API_BASE_URL}/api/orders`);
        if (!response.ok) throw new Error('Failed to fetch orders');
        
        const orders = await response.json();
        currentOrders = orders;
        filteredOrders = orders;
        
        updateStatistics();
        renderOrdersTable();
      } catch (error) {
        console.error('Error loading orders:', error);
        ordersContainer.innerHTML = `
          <div class="no-orders">
            <p>Failed to load orders. Please try again.</p>
          </div>
        `;
      }
    }
    
    // Update statistics
    function updateStatistics() {
      const stats = {
        pending: 0,
        processing: 0,
        shipped: 0,
        delivered: 0
      };
      
      currentOrders.forEach(order => {
        const status = order.status || 'pending';
        if (stats.hasOwnProperty(status)) {
          stats[status]++;
        }
      });
      
      document.getElementById('pending-count').textContent = stats.pending;
      document.getElementById('processing-count').textContent = stats.processing;
      document.getElementById('shipped-count').textContent = stats.shipped;
      document.getElementById('delivered-count').textContent = stats.delivered;
    }
    
    // Render orders table
    function renderOrdersTable() {
      if (filteredOrders.length === 0) {
        ordersContainer.innerHTML = `
          <div class="no-orders">
            <p>No orders found.</p>
          </div>
        `;
        return;
      }
      
      const tableHTML = `
        <table class="orders-table">
          <thead>
            <tr>
              <th>Order ID</th>
              <th>Customer</th>
              <th>Phone</th>
              <th>Total</th>
              <th>Status</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            ${filteredOrders.map(order => `
              <tr>
                <td><span class="order-id" onclick="viewOrderDetails('${order.id}')">${order.id}</span></td>
                <td>${order.customerName}</td>
                <td>${order.customerPhone || 'N/A'}</td>
                <td>₹${order.total.toFixed(2)}</td>
                <td><span class="status-badge status-${order.status || 'pending'}">${order.status || 'Pending'}</span></td>
                <td>${new Date(order.createdAt).toLocaleDateString()}</td>
                <td>
                  <div class="action-buttons">
                    <button class="action-btn view-btn" onclick="viewOrderDetails('${order.id}')">View</button>
                    <button class="action-btn edit-btn" onclick="editOrderStatus('${order.id}')">Edit</button>
                  </div>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
      
      ordersContainer.innerHTML = tableHTML;
    }
    
    // Show loading spinner
    function showLoading() {
      ordersContainer.innerHTML = `
        <div class="loading">
          <div class="spinner"></div>
          <p>Loading orders...</p>
        </div>
      `;
    }
    
    // View order details
    async function viewOrderDetails(orderId) {
      try {
        const response = await fetch(`${API_BASE_URL}/api/orders/${orderId}`);
        if (!response.ok) throw new Error('Failed to fetch order');
        
        const order = await response.json();
        currentOrder = order;
        
        // Populate order details
        const orderDetailsHTML = `
          <div class="detail-row">
            <span class="detail-label">Order ID:</span>
            <span class="detail-value">${order.id}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Customer Name:</span>
            <span class="detail-value">${order.customerName}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Phone:</span>
            <span class="detail-value">${order.customerPhone || 'N/A'}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Email:</span>
            <span class="detail-value">${order.customerEmail || 'N/A'}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Address:</span>
            <span class="detail-value">${order.address}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Total:</span>
            <span class="detail-value">₹${order.total.toFixed(2)}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Order Date:</span>
            <span class="detail-value">${new Date(order.createdAt).toLocaleString()}</span>
          </div>
          
          <h4>Order Items:</h4>
          <div class="order-items-list">
            ${order.items.map(item => `
              <div class="order-item">
                <div class="item-info">
                  <div class="item-name">${item.name}</div>
                  <div class="item-details">Quantity: ${item.quantity} × ₹${item.price.toFixed(2)}</div>
                </div>
                <div class="item-price">₹${item.lineTotal.toFixed(2)}</div>
              </div>
            `).join('')}
          </div>
        `;
        
        document.getElementById('order-details').innerHTML = orderDetailsHTML;
        
        // Set current status
        const currentStatus = order.status || 'pending';
        const statusRadio = document.querySelector(`input[name="status"][value="${currentStatus}"]`);
        if (statusRadio) {
          statusRadio.checked = true;
          statusRadio.closest('.status-option').classList.add('selected');
        }
        
        // Generate quick actions
        generateQuickActions(currentStatus);
        
        // Show modal
        orderModal.style.display = 'block';
      } catch (error) {
        console.error('Error fetching order details:', error);
        showToast('Failed to load order details', 'error');
      }
    }
    
    // Edit order status (same as view but with edit focus)
    function editOrderStatus(orderId) {
      viewOrderDetails(orderId);
      // Scroll to status update section
      setTimeout(() => {
        document.querySelector('.status-options').scrollIntoView({ behavior: 'smooth' });
      }, 300);
    }
    
    // Generate quick actions based on current status
    function generateQuickActions(currentStatus) {
      const quickActionsContainer = document.getElementById('quick-actions');
      let actions = [];
      
      switch(currentStatus) {
        case 'pending':
          actions = [
            { status: 'processing', label: 'Mark as Processing' }
          ];
          break;
        case 'processing':
          actions = [
            { status: 'shipped', label: 'Mark as Shipped' }
          ];
          break;
        case 'shipped':
          actions = [
            { status: 'out-for-delivery', label: 'Mark as Out for Delivery' }
          ];
          break;
        case 'out-for-delivery':
          actions = [
            { status: 'delivered', label: 'Mark as Delivered' }
          ];
          break;
        case 'delivered':
          // No actions for delivered orders
          break;
      }
      
      quickActionsContainer.innerHTML = actions.map(action => `
        <button class="quick-action-btn" data-status="${action.status}">${action.label}</button>
      `).join('');
      
      // Add event listeners to quick action buttons
      quickActionsContainer.querySelectorAll('.quick-action-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const status = this.dataset.status;
          const statusRadio = document.querySelector(`input[name="status"][value="${status}"]`);
          if (statusRadio) {
            statusRadio.checked = true;
            updateStatusSelection();
          }
        });
      });
    }
    
    // Update status selection styling
    function updateStatusSelection() {
      document.querySelectorAll('.status-option').forEach(option => {
        option.classList.remove('selected');
      });
      
      const selectedRadio = document.querySelector('input[name="status"]:checked');
      if (selectedRadio) {
        selectedRadio.closest('.status-option').classList.add('selected');
      }
    }
    
    // Update order status
    async function updateOrderStatus() {
      if (!currentOrder) return;
      
      const selectedStatus = document.querySelector('input[name="status"]:checked').value;
      const note = document.getElementById('status-note').value;
      const notifyCustomer = document.getElementById('notify-customer').checked;
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/orders/${currentOrder.id}/status`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            status: selectedStatus,
            note: note,
            notifyCustomer: notifyCustomer
          })
        });
        
        if (!response.ok) throw new Error('Failed to update order status');
        
        const result = await response.json();
        
        // Update local order data
        const orderIndex = currentOrders.findIndex(o => o.id === currentOrder.id);
        if (orderIndex !== -1) {
          currentOrders[orderIndex].status = selectedStatus;
        }
        
        // Refresh display
        updateStatistics();
        renderOrdersTable();
        
        // Close modal
        orderModal.style.display = 'none';
        
        // Show success message
        showToast('Order status updated successfully', 'success');
        
        // Clear form
        document.getElementById('status-note').value = '';
        document.getElementById('notify-customer').checked = true;
      } catch (error) {
        console.error('Error updating order status:', error);
        showToast('Failed to update order status', 'error');
      }
    }
    
    // Search functionality
    searchInput.addEventListener('input', function() {
      const searchTerm = this.value.toLowerCase();
      const statusFilterValue = statusFilter.value;
      
      filteredOrders = currentOrders.filter(order => {
        const matchesSearch = !searchTerm || 
          order.id.toLowerCase().includes(searchTerm) ||
          order.customerName.toLowerCase().includes(searchTerm) ||
          (order.customerPhone && order.customerPhone.includes(searchTerm));
        
        const matchesStatus = !statusFilterValue || 
          (order.status || 'pending') === statusFilterValue;
        
        return matchesSearch && matchesStatus;
      });
      
      renderOrdersTable();
    });
    
    // Status filter functionality
    statusFilter.addEventListener('change', function() {
      const searchTerm = searchInput.value.toLowerCase();
      const statusFilterValue = this.value;
      
      filteredOrders = currentOrders.filter(order => {
        const matchesSearch = !searchTerm || 
          order.id.toLowerCase().includes(searchTerm) ||
          order.customerName.toLowerCase().includes(searchTerm) ||
          (order.customerPhone && order.customerPhone.includes(searchTerm));
        
        const matchesStatus = !statusFilterValue || 
          (order.status || 'pending') === statusFilterValue;
        
        return matchesSearch && matchesStatus;
      });
      
      renderOrdersTable();
    });
    
    // Refresh functionality
    refreshBtn.addEventListener('click', loadAllOrders);
    
    // Modal event listeners
    modalClose.addEventListener('click', function() {
      orderModal.style.display = 'none';
    });
    
    cancelBtn.addEventListener('click', function() {
      orderModal.style.display = 'none';
    });
    
    saveBtn.addEventListener('click', updateOrderStatus);
    
    // Status radio change event
    document.querySelectorAll('input[name="status"]').forEach(radio => {
      radio.addEventListener('change', updateStatusSelection);
    });
    
    // Close modal when clicking outside
    window.addEventListener('click', function(event) {
      if (event.target === orderModal) {
        orderModal.style.display = 'none';
      }
    });
    
    // Toast notification function
    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      
      document.body.appendChild(toast);
      toast.style.display = 'block';
      
      setTimeout(() => {
        toast.style.display = 'none';
        document.body.removeChild(toast);
      }, 3000);
    }
    
    // Auto-refresh every 30 seconds
    setInterval(() => {
      if (adminContainer.style.display === 'block') {
        loadAllOrders();
      }
    }, 30000);
  </script>
</body>
</html>
